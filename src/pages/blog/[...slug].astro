---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Navigation from '../../components/Navigation.astro';
import CTA from '../../components/CTA.astro';
import Footer from '../../components/Footer.astro';
import { getCollection } from 'astro:content';
import { getImage } from 'astro:assets';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
const baseUrl = import.meta.env.BASE_URL;

// Optimize featured image to WebP
const optimizedImage = await getImage({
  src: post.data.image,
  format: 'webp',
  quality: 85,
  width: 1200,
  height: 675,
});
---

<BaseLayout title={`${post.data.title} — HealthCarePlus Blog`} description={post.data.description}>
  <Navigation />

  <article class="blogPost">
    <div class="container">
      <!-- Back Link -->
      <a href={`${baseUrl}blog/`} class="backLink">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        Back to Blog
      </a>

      <!-- Post Header — No reveal delay on reading content -->
      <header class="postHeader">
        <div class="postCategory" transition:name={`category-${post.slug}`}>
          {post.data.category}
        </div>
        <h1 transition:name={`title-${post.slug}`}>{post.data.title}</h1>
        <div class="postMeta">
          <span class="postAuthor">By {post.data.author}</span>
          <span class="postDate">{post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
        </div>
      </header>

      <!-- Featured Image -->
      <div class="featuredImage">
        <img
          src={optimizedImage.src}
          alt={post.data.title}
          width={1200}
          height={675}
          loading="eager"
          transition:name={`blog-${post.slug}`}
        />
      </div>

      <!-- Post Content — Visible immediately, no reveal delay -->
      <div class="postContent">
        <Content />
      </div>
    </div>
  </article>

  <CTA />
  <Footer />
</BaseLayout>

<style>
  .blogPost {
    padding: calc(var(--space-16) + 80px) 0 var(--space-16);
  }

  .container {
    max-width: 800px;
  }

  .backLink {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-family: var(--font-heading);
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-muted);
    margin-bottom: var(--space-8);
    transition: all 0.2s var(--ease-out);
  }

  .backLink:hover {
    color: var(--primary);
    gap: var(--space-3);
  }

  .postHeader {
    text-align: center;
    margin-bottom: var(--space-8);
  }

  .postCategory {
    display: inline-block;
    padding: var(--space-2) var(--space-4);
    background: var(--primary);
    color: white;
    font-family: var(--font-heading);
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: var(--radius-full);
    margin-bottom: var(--space-5);
  }

  .postHeader h1 {
    margin-bottom: var(--space-5);
  }

  .postMeta {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-4);
    font-size: var(--text-sm);
    color: var(--text-muted);
  }

  .postAuthor {
    font-weight: 600;
    color: var(--primary);
  }

  .postDate::before {
    content: '•';
    margin-right: var(--space-4);
  }

  .featuredImage {
    margin-bottom: var(--space-10);
    border-radius: var(--radius-2xl);
    overflow: hidden;
  }

  .featuredImage img {
    width: 100%;
    aspect-ratio: 16 / 9;
    object-fit: cover;
  }

  .postContent {
    font-size: var(--text-lg);
    line-height: 1.8;
  }

  .postContent :global(h2) {
    margin-top: var(--space-10);
    margin-bottom: var(--space-5);
  }

  .postContent :global(h3) {
    margin-top: var(--space-8);
    margin-bottom: var(--space-4);
  }

  .postContent :global(p) {
    margin-bottom: var(--space-5);
  }

  .postContent :global(ul),
  .postContent :global(ol) {
    margin-bottom: var(--space-5);
    padding-left: var(--space-6);
  }

  .postContent :global(li) {
    margin-bottom: var(--space-3);
  }

  .postContent :global(strong) {
    font-weight: 600;
    color: var(--text);
  }

  .postContent :global(a) {
    color: var(--primary);
    font-weight: 600;
  }

  .postContent :global(a:hover) {
    color: var(--accent);
    text-decoration: underline;
  }
</style>
