---
import { getImage } from 'astro:assets';

const baseUrl = import.meta.env.BASE_URL;

// Optimize hero image to WebP
const heroImageUrl = 'https://images.unsplash.com/photo-1631217868264-e5b90bb7e133?w=1400&h=1000&fit=crop&q=80';
const optimizedHero = await getImage({
  src: heroImageUrl,
  format: 'webp',
  quality: 85,
  width: 1400,
  height: 1000,
});
---

<!-- Sticky Book Appointment Button -->
<div class="stickyBooking" id="sticky-booking">
  <a href={`${baseUrl}contact/`} class="stickyBtn">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
      <line x1="16" y1="2" x2="16" y2="6"></line>
      <line x1="8" y1="2" x2="8" y2="6"></line>
      <line x1="3" y1="10" x2="21" y2="10"></line>
    </svg>
    Book Appointment
  </a>
</div>

<section class="hero">
  <div class="container">
    <div class="heroContent">
      <!-- Main Hero Text -->
      <div class="heroMain">
        <div class="badge">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          <span>Award-Winning Healthcare Since 2010</span>
        </div>

        <h1>Expert Medical Care<br/>When You Need It Most</h1>

        <p class="lead">
          Comprehensive, compassionate healthcare for you and your family. Book online in 60 seconds or walk in today.
        </p>

        <!-- Role-Based Quick Actions -->
        <div class="quickActions">
          <a href={`${baseUrl}contact/`} class="actionCard primary">
            <div class="actionIcon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </div>
            <div class="actionText">
              <div class="actionLabel">I'm a Patient</div>
              <div class="actionDesc">Book appointment</div>
            </div>
            <svg class="actionArrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </a>

          <a href="#find-doctor" class="actionCard">
            <div class="actionIcon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
            </div>
            <div class="actionText">
              <div class="actionLabel">Find a Doctor</div>
              <div class="actionDesc">Search specialists</div>
            </div>
            <svg class="actionArrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </a>
        </div>

        <!-- Trust Badges -->
        <div class="trustBadges">
          <div class="trustItem">
            <div class="trustIcon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="8" r="7"></circle>
                <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
              </svg>
            </div>
            <div class="trustText">Best Clinic 2025</div>
          </div>
          <div class="trustItem">
            <div class="trustIcon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
            </div>
            <div class="trustText">JCI Accredited</div>
          </div>
          <div class="trustItem">
            <div class="trustIcon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg>
            </div>
            <div class="trustText">4.9/5 Rating</div>
          </div>
        </div>
      </div>

      <!-- Hero Image with Stats -->
      <div class="heroVisual">
        <div class="heroImageWrapper">
          <img
            src={optimizedHero.src}
            alt="Modern medical facility"
            width={1400}
            height={1000}
            loading="eager"
          />

          <!-- Animated Stats Cards -->
          <div class="statCard stat1">
            <div class="statNumber" data-count="5000">0</div>
            <div class="statLabel">Happy Patients</div>
          </div>

          <div class="statCard stat2">
            <div class="statNumber" data-count="98">0</div>
            <div class="statLabel">Satisfaction Rate</div>
          </div>

          <div class="statCard stat3">
            <div class="statNumber" data-count="15">0</div>
            <div class="statLabel">Years Excellence</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* Sticky Booking Button */
  .stickyBooking {
    position: fixed;
    bottom: var(--space-6);
    right: var(--space-6);
    z-index: 99;
    opacity: 0;
    transform: translateY(100px);
    transition: all 0.4s var(--ease-out);
  }

  .stickyBooking.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .stickyBtn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-4) var(--space-6);
    background: var(--accent);
    color: white;
    font-family: var(--font-heading);
    font-size: var(--text-base);
    font-weight: 700;
    border-radius: var(--radius-full);
    box-shadow: 0 8px 24px rgba(249, 115, 22, 0.4);
    transition: all 0.3s var(--ease-out);
  }

  .stickyBtn:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 32px rgba(249, 115, 22, 0.5);
  }

  /* Hero Section */
  .hero {
    position: relative;
    min-height: 100vh;
    display: flex;
    align-items: center;
    padding: calc(var(--space-16) + 80px) 0 var(--space-16);
    background: linear-gradient(135deg, var(--bg) 0%, #f0f9ff 100%);
    overflow: hidden;
    opacity: 0;
    animation: heroFadeIn 0.8s ease-out 0.2s forwards;
  }

  @keyframes heroFadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Premium background gradient orbs */
  .hero::before,
  .hero::after {
    content: '';
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.4;
    z-index: 0;
    pointer-events: none;
  }

  .hero::before {
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, rgba(8, 145, 178, 0.3) 0%, transparent 70%);
    top: -200px;
    right: -100px;
  }

  .hero::after {
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, rgba(249, 115, 22, 0.2) 0%, transparent 70%);
    bottom: -150px;
    left: -100px;
  }

  .heroContent {
    display: grid;
    grid-template-columns: 1.1fr 1fr;
    gap: var(--space-12);
    align-items: center;
    position: relative;
    z-index: 1;
  }

  /* Main Content */
  .badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-4);
    background: white;
    border: 1px solid rgba(8, 145, 178, 0.2);
    border-radius: var(--radius-full);
    font-family: var(--font-heading);
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--primary);
    margin-bottom: var(--space-6);
  }

  .badge svg {
    width: 16px;
    height: 16px;
  }

  h1 {
    font-size: clamp(36px, 7vw, 72px);
    line-height: 1.1;
    margin-bottom: var(--space-5);
  }

  .lead {
    font-size: var(--text-xl);
    line-height: 1.7;
    margin-bottom: var(--space-8);
    max-width: 540px;
  }

  /* Quick Actions - Role Based */
  .quickActions {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-4);
    margin-bottom: var(--space-8);
  }

  .actionCard {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    padding: var(--space-5);
    background: white;
    border: 2px solid var(--border);
    border-radius: var(--radius-xl);
    transition: all 0.3s var(--ease-out);
    cursor: pointer;
  }

  .actionCard.primary {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
  }

  .actionCard:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);
  }

  .actionCard.primary:hover {
    background: var(--accent);
    border-color: var(--accent);
  }

  .actionIcon {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(8, 145, 178, 0.1);
    border-radius: var(--radius-lg);
    flex-shrink: 0;
  }

  .actionCard.primary .actionIcon {
    background: rgba(255, 255, 255, 0.2);
  }

  .actionIcon svg {
    width: 24px;
    height: 24px;
    color: var(--primary);
  }

  .actionCard.primary .actionIcon svg {
    color: white;
  }

  .actionText {
    flex: 1;
  }

  .actionLabel {
    font-family: var(--font-heading);
    font-size: var(--text-base);
    font-weight: 700;
    color: var(--text);
    margin-bottom: 2px;
  }

  .actionCard.primary .actionLabel {
    color: white;
  }

  .actionDesc {
    font-size: var(--text-sm);
    color: var(--text-muted);
  }

  .actionCard.primary .actionDesc {
    color: rgba(255, 255, 255, 0.9);
  }

  .actionArrow {
    flex-shrink: 0;
    color: var(--primary);
    transition: transform 0.3s var(--ease-out);
  }

  .actionCard.primary .actionArrow {
    color: white;
  }

  .actionCard:hover .actionArrow {
    transform: translateX(4px);
  }

  /* Trust Badges */
  .trustBadges {
    display: flex;
    gap: var(--space-6);
    flex-wrap: wrap;
  }

  .trustItem {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .trustIcon {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .trustIcon svg {
    width: 18px;
    height: 18px;
    color: var(--accent);
    stroke-width: 2;
  }

  .trustText {
    font-family: var(--font-heading);
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-muted);
  }

  /* Hero Visual */
  .heroImageWrapper {
    position: relative;
  }

  .heroImageWrapper img {
    width: 100%;
    border-radius: var(--radius-2xl);
    box-shadow: 0 24px 48px rgba(0, 0, 0, 0.12);
  }

  /* Animated Stat Cards */
  .statCard {
    position: absolute;
    padding: var(--space-4) var(--space-5);
    background: white;
    border-radius: var(--radius-lg);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    backdrop-filter: blur(10px);
    animation: floatStat 4s ease-in-out infinite;
  }

  .statNumber {
    font-family: var(--font-heading);
    font-size: var(--text-4xl);
    font-weight: 800;
    color: var(--primary);
    line-height: 1;
    margin-bottom: var(--space-2);
  }

  .statLabel {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .stat1 {
    top: 40px;
    left: -40px;
  }

  .stat2 {
    top: 50%;
    right: -50px;
    animation-delay: -2s;
  }

  .stat3 {
    bottom: 40px;
    left: -30px;
    animation-delay: -1s;
  }

  @keyframes floatStat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-12px); }
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .heroContent {
      grid-template-columns: 1fr;
      gap: var(--space-10);
    }

    .quickActions {
      grid-template-columns: 1fr;
    }

    .stat1 { left: 0; top: 20px; }
    .stat2 { right: 0; }
    .stat3 { left: 0; bottom: 20px; }
  }

  @media (max-width: 640px) {
    .hero {
      min-height: auto;
      padding: calc(var(--space-8) + 72px) 0 var(--space-8);
    }

    .stickyBooking {
      bottom: var(--space-4);
      right: var(--space-4);
    }

    .stickyBtn {
      padding: var(--space-3) var(--space-5);
      font-size: var(--text-sm);
    }

    .statCard {
      padding: var(--space-2) var(--space-3);
      transform: scale(0.85);
    }

    .statNumber {
      font-size: var(--text-xl);
    }

    .statLabel {
      font-size: 0.65rem;
    }

    /* Adjust stat card positions for mobile */
    .stat1 {
      top: 10px;
      left: -10px;
    }

    .stat2 {
      top: 50%;
      right: -10px;
    }

    .stat3 {
      bottom: 10px;
      left: -10px;
    }
  }
</style>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  function initHero() {
    // Sticky booking button on scroll
    const stickyBooking = document.getElementById('sticky-booking');
    if (stickyBooking) {
      window.addEventListener('scroll', () => {
        if (window.scrollY > 600) {
          stickyBooking.classList.add('visible');
        } else {
          stickyBooking.classList.remove('visible');
        }
      });
    }

    // Premium parallax effects with GSAP
    const heroMain = document.querySelector('.heroMain');
    const heroVisual = document.querySelector('.heroVisual');
    const statCards = document.querySelectorAll('.statCard');

    if (heroMain) {
      gsap.to(heroMain, {
        y: 100,
        opacity: 0.8,
        scrollTrigger: {
          trigger: '.hero',
          start: 'top top',
          end: 'bottom top',
          scrub: 1,
        }
      });
    }

    if (heroVisual) {
      gsap.to(heroVisual, {
        y: 150,
        scale: 0.95,
        scrollTrigger: {
          trigger: '.hero',
          start: 'top top',
          end: 'bottom top',
          scrub: 1,
        }
      });
    }

    // Stat cards floating parallax
    statCards.forEach((card, index) => {
      gsap.to(card, {
        y: -80 * (index + 1),
        scrollTrigger: {
          trigger: '.hero',
          start: 'top top',
          end: 'bottom top',
          scrub: 1.5,
        }
      });
    });

    // Animated counters
    const counters = document.querySelectorAll('[data-count]');
    const animateCounter = (element: Element) => {
      const target = parseInt(element.getAttribute('data-count') || '0');
      const duration = 2000;
      const increment = target / (duration / 16);
      let current = 0;

      const updateCounter = () => {
        current += increment;
        if (current < target) {
          element.textContent = Math.ceil(current).toLocaleString();
          requestAnimationFrame(updateCounter);
        } else {
          element.textContent = target.toLocaleString() + (target === 98 ? '%' : '+');
        }
      };

      updateCounter();
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          animateCounter(entry.target);
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.5 });

    counters.forEach((counter) => observer.observe(counter));
  }

  document.addEventListener('DOMContentLoaded', initHero);
  document.addEventListener('astro:page-load', initHero);
</script>
